<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
    <title>Profile</title>
</head>

<style>
    body {

        font-family: 'Montserrat', sans-serif;
        padding: 25px;
    }

    /*--------------------------- HEADER ------------------------*/

    header {
        display: flex;
        flex-direction: row;
        justify-content: space-between;
        padding: 10px;
        border-bottom: 1px solid rgb(197, 197, 197);
    }

    .booklogo {
        width: 60px;
        height: 60px;
    }

    .userNameTitle {
        color: rgb(98, 0, 179);
    }



    .headerContainer {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: end;
        text-align: center;
        padding-left: 50px;
        padding-right: 50px;
    }

    .headerButtonsContainers {
        display: flex;
        flex-direction: row;
        justify-content: space-between;
        align-items: center;
        width: 125px;
    }

    .signUpButton {
        color: black;
        text-decoration: none;
        cursor: pointer;
    }

    .signUpButton:hover {
        color: rgb(98, 0, 179);
    }

    /*--------------------------- CONTENT ------------------------*/

    .contentSection {
        margin-top: 50px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        text-align: center;
        padding: 10px;
    }

    .contentDiv {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        text-align: center;
        color: white;
        width: 800px;
        background-color: rgb(98, 0, 179);
        border-radius: 15px;
        padding: 100px;
    }

    .editDivContainer {
        display: flex;
        flex-direction: row;
        align-items: center;
    }

    .tr {
        padding: 20px;
    }

    .inputTitle {
        text-align: start;
        font-weight: bold;
        margin-right: 25px;

    }

    .inputLabel {
        text-align: start;
    }

    .inputStyle {
        width: 300px;
        border: none;
        border-radius: 25px;
        padding: 10px;
        margin: 15px;
    }

    .inputStyle:hover {
        border: none;
    }

    .buttonStyle {
        font-weight: bolder;
        font-size: medium;
        color: rgb(98, 0, 179);
        background-color: white;
        border: 3px solid white;
        border-radius: 25px;
        padding: 10px 25px;
        cursor: pointer;
        font-size: smaller;
    }

    .buttonStyle:hover {

        background-color: rgb(245, 241, 241);
    }
</style>

<body>

    <header>
        <div class="headerContainer"><img class="booklogo" src="\assets\logo.png" alt=""></div>
        <div class="headerContainer">
            <h1>Bookshelf</h1>
        </div>
        <div class="headerButtonsContainers">
            <a class="signUpButton" id="logoutButton">Log out</a>
            <a class="signUpButton" href="\views\dashboard.html">Home</a>
        </div>
    </header>
    <br>
    <h2 id="userNameTitle" class="userNameTitle"></h2>

    <section class="contentSection">
        <div class="contentDiv">
            <h2>Profile</h2>
            <form id="updateFullNameForm" action="">
                <table>
                    <tr>
                        <td>
                            <p class="inputTitle">Full name:</p>
                        </td>
                        <td><label id="fullname" class="inputLabel"></label></td>
                        <td><input id="editedFullname" type="text" class="inputStyle" maxlength="16"
                                placeholder="edit full name" required></td>
                        <td><input type="submit" class="buttonStyle" value="EDIT"></td>
                    </tr>
                </table>
            </form>

            <br><br>

            <form id="updatePasswordForm" action="">
                <table>
                    <tr>
                        <td>
                            <p class="inputTitle">Password:</p>
                        </td>
                        <td><label class="inputLabel">********</label></td>
                        <td><input id="editedPassword" type="text" class="inputStyle" maxlength="16"
                                placeholder="edit password" required></td>
                        <td><input type="submit" class="buttonStyle" value="EDIT"></td>
                    </tr>
                </table>
            </form>
        </div>
    </section>


</body>

<script>
    (() => {
        const App = (() => {

            const htmlElements = {
                logout: document.querySelector('#logoutButton'),
                userTitle: document.querySelector('#userNameTitle'),
                fullname: document.querySelector('#fullname'),
                formFullName: document.querySelector('#updateFullNameForm'),
                formPassword: document.querySelector('#updatePasswordForm'),
            }

            const methods = {

                printUserName(field) {

                    const User = JSON.parse(localStorage.getItem('login_success')) || []
                    const name = User.fullname
                    field.innerHTML = `${name}`
                },

                updateUser({ field, newValue }) {
                    const currentUser = JSON.parse(localStorage.getItem('login_success'));

                    const users = JSON.parse(localStorage.getItem('users')) || [];

                    const updatedUsers = users.map(u => {
                        if (u.username === currentUser.username) {
                            u[field] = newValue;
                        }
                        return u;
                    });

                    localStorage.setItem('users', JSON.stringify(updatedUsers));

                    alert('Profile updated. You will be logged out.');
                    localStorage.removeItem('login_success');
                    window.location.href = '/views/index.html';
                },

                hashCode(str) {

                    let hash = 0;

                    for (let i = 0; i < str.length; i++) {

                        let chr = str.charCodeAt(i);
                        hash = (hash << 5) - hash + chr;
                        hash |= 0;
                    }
                    return hash;

                },
            }

            const handlers = {


                onProgressSession() {
                    const user = JSON.parse(localStorage.getItem('login_success')) || false
                    if (!user) {
                        window.location.href = 'index.html'
                    }
                },

                logOutSession() {
                    alert('Good bye!')
                    localStorage.removeItem('login_success')
                    window.location.href = 'index.html'
                },

                onFullNameSubmit(e) {
                    e.preventDefault();
                    const newFullname = htmlElements.formFullName.editedFullname.value.trim();
                    if (newFullname) {
                        methods.updateUser({ field: 'fullname', newValue: newFullname });
                    }
                },

                onPasswordSubmit(e) {
                    e.preventDefault();
                    const newPassword = methods.hashCode(htmlElements.formPassword.editedPassword.value.trim());
                    if (newPassword) {
                        methods.updateUser({ field: 'password', newValue: newPassword });
                    }
                },

            }

            return {
                init() {
                    handlers.onProgressSession()

                    htmlElements.logout.addEventListener('click', handlers.logOutSession)
                    methods.printUserName(htmlElements.userTitle)
                    methods.printUserName(htmlElements.fullname)
                    htmlElements.formFullName.addEventListener('submit', handlers.onFullNameSubmit);
                    htmlElements.formPassword.addEventListener('submit', handlers.onPasswordSubmit);


                },
            }
        })();
        App.init()
    })();
</script>

</html>